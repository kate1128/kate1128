> [https://open.bigmodel.cn/dev/howuse/finetuning](https://open.bigmodel.cn/dev/howuse/finetuning)
>

通常，完成模型微调包括以下步骤：

1. 准备并上传训练数据
2. 训练新的微调模型
3. 部署并使用微调模型（仅文生文模型LoRA微调后支持公有池推理，其他情况均需部署后推理使用。）
4. 评估结果，如有必要，返回步骤1

#  准备训练数据
微调训练数据通常由一批包含输入和预期输出的数据组成，每条训练数据包含一个输入（Prompt）及其对应的预期输出。目前仅支持JSON格式文件上传训练数据。

## 数据集要求
一般来说，提供更多高质量的训练数据会得到更好的微调效果。反之，如果训练数据存在问题或缺陷，将会对微调结果产生负面影响。

+ **更多高质量数据：** 为了更好地微调模型，你需要提供至少数百条高质量的训练数据；最好由人工严格审核数据，以确保数据质量和微调结果。增加高质量的训练数据是改善微调结果的最佳且最可靠的方法。
+ **根据训练目标调整数据分布：** 在构建训练数据时，你需要根据实际业务场景的训练目标，注意构建和调整各类细分任务场景的训练数据分布，并尽量覆盖业务场景中所有可能的数据样本。如果你的训练目标是同时提升文本分类、信息抽取和文本生成的效果，你需要在训练数据中为这些类型的任务提供足够的训练数据。
+ **避免有害数据：** 为了确保你的数据隐私，平台不会审核你的数据。请确保你的数据不包含有害信息，包括但不限于色情、恐怖主义、政治敏感、低俗辱骂、隐私信息等。使用有害数据进行微调可能会导致微调后的模型容易生成有害内容，降低模型推理结果中敏感信息验证的通过率。更糟糕的是，一个严重有害的模型可能无法通过平台或相关监管机构的内容合规要求，并会被强制从平台移除。

## 数据集格式
### 大语言模型
#### 大语言模型(chat)训练数据格式
准备数据集格式如下所示，以JSON格式每行一条，存储在文件中并通过文件管理接口上传文件：

```json
{"messages": [{"role": "system", "content": "你是一个乐于助人且知识渊博的AI助手。"},{"role": "user", "content": "请解释AlphaGo的基本原理。"}, {"role": "assistant", "content": "AlphaGo结合深度神经网络与树搜索算法，通过棋局数据进行训练，逐步提升棋力，能够判断围棋局势并选择最佳着法。"}]}
{"messages": [{"role": "system", "content": "你是一个乐于助人且知识渊博的AI助手。"},{"role": "user", "content": "列举一些健康饮食的重要原则。"}, {"role": "assistant", "content": "健康饮食的重要原则包括：均衡饮食，合理摄入各类营养素；多吃新鲜蔬果，适量饮水；少吃糖、油、盐，忌吃过量快餐；养成规律生活作息习惯，适量运动。"}]}
{"messages": [{"role": "system", "content": "你是一个乐于助人且知识渊博的AI助手。"},{"role": "user", "content": "给出一些改善睡眠质量的建议。"}, {"role": "assistant", "content": "改善睡眠质量的建议包括：保证睡眠时间，避免睡眠不足；睡前放松，避免刺激；养成规律作息时间，不要频繁熬夜；适量运动，但不要运动过度；睡前可以喝一杯热牛奶等温和饮料。"}]}
```

如果你不需要上传system prompt，只需删除该段落，就是把`{"role": "system", "content":"xxxxx"}`这个角色的上下文删掉， 如下所示：

```json
{"messages": [{"role": "user", "content": "请解释AlphaGo的基本原理。"}, {"role": "assistant", "content": "AlphaGo结合深度神经网络与树搜索算法，通过棋局数据进行训练，逐步提升棋力，能够判断围棋局势并选择最佳着法。"}]}
```

#### 大语言模型(function能力)训练数据格式
目前仅`glm-4-air`、`glm-4-flash`、`glm-4-9b`模型全参微调支持该格式训练

若您希望微调函数调用能力，可用以下版本训练格式。上传的时候是每行一条的 json 格式，存储在文件中并通过文件管理接口上传：

```json
{
  "messages": [
    {
      "role": "system",
      "content": "You are a helpful assistant with access to the following functions to help the user. You can use the functions if needed.",
    },
    {
      "role": "user",
      "content": "Can you help me generate anagrams of the words 'listen' and 'race'?",
    },
    {
      "role": "assistant",
      "tool_calls": [
        {
          "id": "TX92Jm8Zi",
          "type": "function",
          "function": {
            "name": "generate_anagram",
            "arguments": "{\"word\": \"listen\"}"
          }
        }
      ]
    },
    {
      "role": "tool",
      "content": "{\"anagram\": \"silent\"}",
      "tool_call_id": "TX92Jm8Zi"
    }
    {
      "role": "assistant",
      "content": "The anagrams of the words 'listen' is 'silent'."
    },
    {
      "role": "user",
      "content": "That's amazing! You are so powerful."
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "generate_anagram",
        "description": "Generate an anagram of a given word",
        "parameters": {
          "type": "object",
          "properties": {
            "word": {
              "type": "string",
              "description": "The word to generate an anagram of"
            }
          },
          "required": ["word"]
        }
      }
    }
  ]
}
```

### 多模态模型
#### 文生图模型
目前支持Cogview-3模型微调，您可以选择上传图片时选择http url或者base 64格式。使用base 64格式时url前缀需包含data:image/jpeg;base64，上传的时候是每行一条的 json 格式，存储在文件中并通过文件管理接口上传：

##### Http URL
```json
{
  "messages": [{
    "role": "system",
    "content": "你是智谱AI公司的图片生成助手Cogview"},
    {
      "role": "user",
      "content": "一只黑色法式斗牛犬在纽约市摩天大楼的背景下被捕捉到飞行中的瞬间，身穿蓝色西装和红色斗篷，展现出超人的形象。它快乐的表情和张开的嘴巴传达出一种兴奋和顽皮的感觉。这个场景以惊人的真实感呈现，利用光线突出狗的特征，营造出一种生动的氛围，暗示着运动和英雄气概."
    },
    {
      "role": "assistant",
      "content": [{
        "type": "image_url",
        "image_url": {
          "url": "https://www.xxx/xx.jpeg"
        }
      }]
    }]
}
```

##### Base 64
```json
{
  "messages": [{
    "role": "system",
    "content": "你是智谱AI公司的图片生成助手Cogview"},
    {
      "role": "user",
      "content": "一只黑色法式斗牛犬在纽约市摩天大楼的背景下被捕捉到飞行中的瞬间，身穿蓝色西装和红色斗篷，展现出超人的形象。它快乐的表情和张开的嘴巴传达出一种兴奋和顽皮的感觉。这个场景以惊人的真实感呈现，利用光线突出狗的特征，营造出一种生动的氛围，暗示着运动和英雄气概."
    },
    {
      "role": "assistant",
      "content": [{
        "type": "image_url",
        "image_url": {
          "url": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/.........."
        }
      }]
    }]
}
```

#### 图生文模型
目前支持GLM-4V模型微调，您可以选择上传图片时选择http url或者base 64格式。使用base 64格式时url前缀需包含前缀：data:image/jpeg;base64，上传的时候是每行一条的 json 格式，存储在文件中并通过文件管理接口上传：

##### Http URL
```json
{
  "messages": [{
    "role": "system",
    "content": "你是智谱AI公司的AI助手GLM-4V。"
  },
    {
      "role": "user",
      "content": "图里是什么"
    },
    {
      "role": "user",
      "content": [
        {
          "type": "image_url",
          "image_url": {
            "url": "https://www.zhipuai.cn/assets/images/aboutus/company.jpeg"
          }
        }]
    },
    {
      "role": "assistant",
      "content": "这张图片展示了一张贴在墙上的通知"
    },
    {
      "role": "user",
      "content":"结合最近的新闻"
    },
    {
      "role": "assistant",
      "content": "南京市公安局刚刚报道，自己年7月开始，全市查处了100次电动车违规。"
    }]
}
```

##### Base 64
```json
{
  "messages": [{
    "role": "system",
    "content": "你是智谱AI公司的AI助手GLM-4V。"
  },
    {
      "role": "user",
      "content": "图里是什么"
    },
    {
      "role": "user",
      "content": [
        {
          "type": "image_url",
          "image_url": {
            "url": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/.........."
          }
        }]
    },
    {
      "role": "assistant",
      "content": "这张图片展示了一张贴在墙上的通知"
    },
    {
      "role": "user",
      "content":"结合最近的新闻"
    },
    {
      "role": "assistant",
      "content": "南京市公安局刚刚报道，自己年7月开始，全市查处了100次电动车违规。"
    }]
}
```

## 数据集上传
### 入口1：[微调数据页面](http://bigmodel.cn/console/modelft/dataset)
根据您需要微调的场景，目前可以选择数据集分类为大语言模型(chat)训练数据、大语言模型(function能力)训练数据。  
![](https://cdn.nlark.com/yuque/0/2025/png/2639475/1737684625205-e28f25c9-84bf-4c28-809f-699835ac4856.png)

### 入口2：[微调任务创建](http://bigmodel.cn/console/modelft/finetuning/create)
您也可以直接在微调任务创建时选择上传新数据集，提交的数据集会自动更新到您的「微调数据」内  
![](https://cdn.nlark.com/yuque/0/2025/png/2639475/1737684625758-34bfbd97-f8f7-4630-b5de-73200e00f19f.png)

# 创建微调任务
如果你已经按照上述要求准备好了高质量的训练数据，现在可以创建微调任务来训练模型了。

你可以通过页面操作创建微调任务，入口如下：

## 微调任务入口1：[微调任务](https://open.bigmodel.cn/console/modelft/finetuning) 
点击“创建微调任务”按钮。

![](https://cdn.nlark.com/yuque/0/2025/png/2639475/1737684627433-bbe84c3d-c99f-4292-8b58-edf041ff1ce5.png)

![](https://cdn.nlark.com/yuque/0/2025/png/2639475/1737684627589-afa6a775-b6ff-4993-bce0-171fe94a28f1.png)

## 微调任务入口2：[模型广场](https://open.bigmodel.cn/console/modelcenter/square) 
鼠标放在指定模型卡片上，会展示出「体验」、「查看详情」按键。点击模型卡片的「查看详情」按钮，进入详情页点击模型微调。

![](https://cdn.nlark.com/yuque/0/2025/png/2639475/1737684627794-a4d8344c-b9a9-4a0c-9d00-5a5f8697b080.png)  
![](https://cdn.nlark.com/yuque/0/2025/png/2639475/1737684630938-56b51e59-048c-4ad0-a73f-67be31e45231.png)

创建微调任务时，你可以根据需要命名新模型并指定模型代码的后缀。其他参数设置请参考微调API接口文档。创建微调任务后，训练完成需要几分钟到几小时不等，具体取决于模型大小和数据集大小。我们会在训练完成后通过短信通知你。

# 部署微调模型
## 模型部署入口
### 入口1：[私有实例](https://open.bigmodel.cn/console/modelcenter/deploy) 
点击“创建部署任务”按钮，选择要部署的基础模型/微调模型。

![](https://cdn.nlark.com/yuque/0/2025/png/2639475/1737684630977-ec941281-20d0-4b4d-8ee3-b4c470be24fa.png)  
![](https://cdn.nlark.com/yuque/0/2025/png/2639475/1737684634345-54370ff4-eda6-4ec1-ad3a-07ad7ea58379.png)

### 入口2：[模型广场](https://open.bigmodel.cn/console/modelcenter/square) 
点击模型卡片的详情按钮（微调完成的模型会在模型生成一个微调模型卡片），进入「查看详情」点击「部署」按键。  
成功部署后，您可以在该卡片的详情页面看到部署的信息。  
![](https://cdn.nlark.com/yuque/0/2025/png/2639475/1737684634471-b63b5040-dc1c-477b-a1d8-8dc86c6ac78c.png)  
![](https://cdn.nlark.com/yuque/0/2025/png/2639475/1737684634584-92070c5c-82d2-42ed-8ac6-3d49c9dc8c62.png)

你可以根据实际使用场景的并发需求选择部署实例的数量。实例部署需要一定时间（通常为10-30分钟，具体取决于模型大小）。我们会在部署完成后通过短信通知你。新部署的模型的模型编码、状态及实例信息可在[私有实例](https://open.bigmodel.cn/console/modelcenter/deploy) 页面或[模型广场](https://open.bigmodel.cn/console/modelcenter/square) 的模型详情页部署信息查看。

## 模型实例变更与取消部署
### 操作实例变更与模型部署取消
您可以在[模型广场](https://open.bigmodel.cn/console/modelcenter/square)的模型详情页或在[私有实例](https://open.bigmodel.cn/console/modelcenter/deploy) 页面选择已经部署的模型进行实例数量变更或者取消部署。

+ 注意：取消部署动作将在操作后立即生效，取消后该部署模型无法再进行调用。  
![](https://cdn.nlark.com/yuque/0/2025/png/2639475/1737684634404-5b3f5ec2-f4fc-4477-9ab8-83ff67816ab9.png)  
![](https://cdn.nlark.com/yuque/0/2025/png/2639475/1737684634511-34d07228-1270-4526-8809-f4dab210fe7f.png)

### 模型卡片删除
+ 当点击模型卡片「删除」按键后，该微调模型及基于该模型部署的模型将均被删除，无法调用。  
![](https://cdn.nlark.com/yuque/0/2025/png/2639475/1737684635700-844ebd33-dc2c-4b79-bd41-fa862e266f84.png)

# 模型推理
## 模型编码获取
可公有池推理的模型可以直接复制模型编码，您也可以选择在测试效果后进行私有实例部署  
![](https://cdn.nlark.com/yuque/0/2025/png/2639475/1737684636237-ab811484-6ee2-4a3f-a712-fcfe3de6fe5a.png)  
需要私有部署后推理的模型需要在部署后进行调用。部署后的编码请在模型广场对应模型卡片详情内或私有实例页面查看  
![](https://cdn.nlark.com/yuque/0/2025/png/2639475/1737684636262-b162cc38-da93-49d8-ae33-103802c20cd2.png)

## 模型调用
你可以通过体验中心或API使用模型。在进行API请求时，你可以将你命名的新的模型代码作为`model`参数的值传递。

调用示例

```python
from zhipuai import ZhipuAI
client = ZhipuAI(api_key="")
response = client.chat.completions.create(
    model="chatglm3-6b-1001",  # 填写你需要调用的模型名称
    messages=[
        {"role": "system", "content": "你是一个名为chatGLM的AI助手。"},
        {"role": "user", "content": "你好！你的名字是什么？"},
    ],
    stream=True,
)
for chunk in response:
    print(chunk.choices[0].delta)
```

调用详细信息可参考 [接口文档](https://bigmodel.cn/dev/api/normal-model/glm-4)

